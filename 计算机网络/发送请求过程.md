
## 一个页面从输入 URL 到页面加载显示完成,这个过程中都发生了什么
1. 根据资源的 HTTP header 判断它是否命中强缓存，命中的话直接从本地获取资源，否则发送请求。
1. 当URL为域名时，先进行 DNS 查询，获取相应的 IP 地址。（主机递归查询和本地域名服务器迭代查询，根域名->顶级域名->权限域名服务器）
1. 浏览器与服务器通过 TCP 三次握手协商来建立一个 TCP/IP 连接。（该握手包括一个同步报文，一个同步-应答报文和一个应答报文。该握手首先由客户端尝试建立起通信，而后服务器应答并接受客户端的请求，最后由客户端发出已经被接受的请求报文。）
1. 浏览器通过该连接向服务器发送 HTTP 的请求。
1. 服务器验证该资源是否命中协商缓存，命中则不返回资源，响应状态码为304；否则找到资源并返回该资源，值为 200 的 HTTP 响应状态表示一个正确的响应。
1. 四次挥手释放连接
1. 浏览器解析报文，渲染输出页面。

## DNS查询过程
> DNS作用是将用户请求的URL映射为具体的IP地址
1. 主机进行递归查询。
    1. 浏览器缓存
    2. 操作系统缓存
    3. 检查本机域名解析文件hosts
    4. 查询本地域名服务器
2. 本地域名服务器如果不知道IP地址，则代替主机进行迭代查询。
    1. 向根域名服务器进行查询，根域名服务器给出查询的IP，否则告诉本地域名服务器下一次查询的顶级域名服务器的IP地址。
    1. 本地域名服务器向顶级域名服务器进行查询，顶级域名服务器给出查询的IP，否则告诉本地域名服务器下一次查询的权限域名服务器的IP地址。
    1. 本地域名服务器向权限域名服务器进行查询，权限域名服务器告诉本地域名服务器所查询的主机的IP。
    1. 本地域名服务器把查询结果告诉主机。

## 浏览器缓存
 - 强缓存：不发请求，直接从缓存读取资源。
 - 协商缓存：强制缓存失效后，浏览器携带缓存标识（If-Modified-Since和if-none-match）向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程。

请求过程：有缓存时，Cache-Control/Expires不过期使用强缓存，否则进行协商缓存，服务器判断ETag与if-none-match&&Last-Modified与If-Modified-Since是否相同，相同则返回304，继续使用缓存；否则返回200和新的资源和缓存标识。
缓存的字段：
 - Cache-Control：控制网页缓存，可以组合使用多种指令：public，private，no-cache，no-store，max-age，s-maxage，max-stale
 - Expires：指定资源到期的时间，=max-age + 请求时间
 - Last-Modified，If-Modified-Since：资源在服务器上的最后修改时间
 - ETag：服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，只要资源有变化，Etag就会重新生成。
 - if-none-match：= ETag

## etag和last-modified区别
本地打开缓存文件，即使没有修改，Last-Modified仍然被修改。
Last-Modified 只能以秒计时，在不可感知的时间内修改文件，服务端会认为资源还是命中了，返回304。

## cdn相关知识
CDN是内容分发网络。将源站内容分发至用户最近的节点，使用户可就近获取内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟的问题，适用于站点加速、直播、点播等场景。

其基本思想是尽可能避开互联网上有可能影响数据传输速度和稳定性瓶颈的环节，使内容传输的更快、更稳定。通过在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各个节点的连接、负载情况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务器节点上。
